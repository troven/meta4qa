<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules/meta4qa-common/lib/dialect/variables.js - meta4qa</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/img/logo.png" title="meta4qa" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>Dialect Definitions for: 1.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Phrases</a></li>
                            <li><a href="#api-modules">Dialects</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Builder.html">Builder</a></li>
                                <li><a href="../classes/Common.html">Common</a></li>
                                <li><a href="../classes/Events.html">Events</a></li>
                                <li><a href="../classes/File System.html">File System</a></li>
                                <li><a href="../classes/TCP Toolkit.html">TCP Toolkit</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Variables.html">Variables</a></li>
                                <li><a href="../classes/Web API.html">Web API</a></li>
                                <li><a href="../classes/X.509 Server Certificates.html">X.509 Server Certificates</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Default Dialect.html">Default Dialect</a></li>
                                <li><a href="../modules/Web API Dialect.html">Web API Dialect</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: node_modules/meta4qa-common/lib/dialect/variables.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var assert = require(&#x27;assert&#x27;);
var request = require(&#x27;request&#x27;);
var _ = require(&#x27;underscore&#x27;);
var fs = require(&#x27;fs&#x27;);
var path = require(&#x27;path&#x27;);
var debug = require(&#x27;debug&#x27;)(&#x27;meta4qa:dialect:variables&#x27;);

var meta4qa = require(&#x27;meta4qa&#x27;),
    helps = meta4qa.helpers,
    vars = helps.vars,
    files = helps.files,
    converts = meta4qa.converts,
    http = helps.http;
/**
 * Variables
 * Configures the Gherkin parser with phrases that support operations on variables
 *
 * @module Default Dialect
 * @class Variables
 *
 */

var self = module.exports = function(learn, config, dialect) {
    assert(learn, &quot;missing learn&quot;);
    assert(config, &quot;missing config&quot;);
    assert(dialect, &quot;missing dialect&quot;);
    assert(helps, &quot;missing helpers&quot;);

    // ***** GIVEN *****

    /**
     * Remove all the scoped variables
     *
     *      I clear variables
     *
     *      I reset variables
     *
     * @example
     *
     *      GIVEN I reset variables
     *      
     * @method Clear Variables
     */

    learn.given([&quot;I clear variables&quot;, &quot;I reset variables&quot;], function(done) {
        for (var name in this.vars) delete this.vars[name];
        done &amp;&amp; done();
    });

    /**
     * Set the value of a scoped variable
     *
     *      I set $varname to $value
     *
     *      I set $varname = $value
     *
     *      I define $varname = $value
     *
     *      I define $varname is $value
     *
     * @example
     *
     *      GIVEN I set hello to world
     *      AND I set yes to true
     *      AND I set nope to false
     *      AND I set answer to 42
     *
     * @method Set Variable
     * @param {String} variable - variable name
     * @param {Object} value - simple value (string | number | boolean)
     */

    learn.given([&quot;I set $varname to $value&quot;, &quot;I set $varname = $value&quot;, &quot;I define $varname = $value&quot;, &quot;I define $varname is $value&quot;], function(name, value, done) {
        vars.set(this.vars, name, value);
        done &amp;&amp; done();
    });

    learn.given([&quot;I set $varname from $varname2&quot;], function(name, var2, done) {
        var value = vars.find(this, var2);
        assert(value!=undefined, &quot;Value &quot;+name+&quot; is undefined&quot;);
        vars.set(this.vars, name, value);
        done &amp;&amp; done();
    });

    // learn.given([&quot;I randomize $varname with $size characters&quot;], function(name, size, done) {
    //     var value = vars.find(this, name);
    //     assert(value!=undefined, &quot;Value &quot;+name+&quot; is undefined&quot;);
    //     vars.set(this.vars, name, value);
    //     done &amp;&amp; done();
    // });

    learn.given([&quot;I want it $varname&quot;, &quot;I want a $varname&quot;, &quot;I want an $varname&quot;], function(name, done) {
        vars.set(this.vars, name, true);
        done &amp;&amp; done();
    });

    learn.given([&quot;I convert $varname to text&quot;], function(name, done) {
        var original = vars.find(this,name);
        vars.set(this.vars,name, JSON.stringify(original));

        done &amp;&amp; done();
    });

    /**
     * Sets the value of a scoped variable to inline CSV data structure
     *
     *      I set $varname to CSV:
     *      -------------
     *      $CSV
     *      -------------
     *
     *      some $varname as CSV:
     *      -------------
     *      $CSV
     *      -------------
     *
     * @example
     *
     *      GIVEN I set my-csv to CSV:
     *      -------------
     *      hello, goodbye
     *      world, earth
     *      -------------
     *
     *  or:
     *
     *      AND some CSV as my-csv:
     *      -------------
     *      hello, goodbye
     *      world, earth
     *      -------------
     *
     *
     * @method Set Variable from CSV
     * @param {String} name - variable name
     * @param {string} CSV - inline CSV text
     */

    learn.given([&quot;I set $varname to CSV:\n$CSV&quot;, &quot;some CSV as $varname:\n$CSV&quot;], function(varname, csv, done) {
        vars.set(this.vars, varname, csv);
        done &amp;&amp; done();
    });

    /**
     * Sets the value of a scoped variable to inline JSON data structure
     * ---------- ---------- ---------- ----------
     *
     * @example
     *
     *      GIVEN I set $varname to JSON:
     *      -------------
     *      { &quot;hello&quot;: &quot;world&quot; }
     *      -------------
     *
     *  or:
     *
     *      AND some JSON as $varname:
     *      -------------
     *      { &quot;hello&quot;: &quot;world&quot; }
     *      -------------
     *
     *
     * @method Set Variable from JSON
     * @param {String} name - variable name
     * @param {Object} JSON - inline JSON
     */

    learn.given([&quot;I set $varname to JSON:\n$JSON&quot;, &quot;some JSON as $varname:\n$JSON&quot;], function(name, json, done) {
        vars.set(this.vars, name, json);
        done &amp;&amp; done();
    });

    learn.given([&quot;I set $varname to text:\n$TEXT&quot;, &quot;some text as $varname:\n$TEXT&quot;], function(name, text, done) {
        vars.set(this.vars, name, text);
        done &amp;&amp; done();
    });

    /**
     * Run Javscript and save result into a variable
     *
     * @example
     *
     *      GIVEN I return 2+3 as my-answer
     *
     *      AND I return new Date().getTime() as now

     * @method Save Javascript to Variable
     * @param {String} javascript - inline javascript
     * @param {string} varname - variable name
     */

    learn.given(&quot;I return $javascript as $varname&quot;, function(js, name, done) {
        var fn = new Function(&quot;return (&quot;+js+&quot;);&quot;);
        var result = fn.apply(this, arguments);
        vars.set(this.vars, name, result);
        done &amp;&amp; done();
    });

    /**
     * Execute Javascript - trigger a fail if return is falsey
     *
     * @example
     *
     *      WHEN I execute (3+4)
     *
     * @method Execute Javascript
     * @param {String} javascript - inline javascript
     */

    learn.when([&quot;I execute $javascript&quot;, &quot;I execute\n$javascript&quot;], function(js, done) {
        var fn = new Function(js);
        var result = fn.apply(this);
        if (typeof(result) != &quot;undefined&quot;) {
            assert(result, &quot;Javascript return &#x27;falsey&#x27;&quot;);
        }
        done &amp;&amp; done();
    });

    /**
     * Assert some Javascript returns true or trigger a fail if return is &#x27;falsey&#x27;
     *
     * @example
     *
     *      GIVEN I am testing
     *      THEN I assert this.name == &quot;testing&quot;
     *
     * @method Assert Javascript
     * @param {String} javascript - inline javascript
     */

    learn.then([&quot;I assert $javascript&quot;,&quot;I expect $javascript&quot;], function(js, done) {
//console.log(&quot;VARS: %s -&gt; %j&quot;, js, _.keys(this));
        var fn = new Function(&quot;return (&quot;+js+&quot;);&quot;);
        var result = fn.apply(this);
        assert(result, &quot;Javascript assert: &quot;+js+&quot; --&gt; &quot;+result);
        done &amp;&amp; done();
    });

    /**
     * Assert some variable is assigned a value that is truthy
     *
     *      variable $varname should exist
     *
     * @example
     *
     *      GIVEN I set variable hello to world
     *      THEN variable hello should exist
     *
     * @method Assert variable is truthy
     * @param {String} varname - scoped variable
     */

    learn.then([&quot;variable $varname should exist&quot;, &quot;variable $varname exists&quot;, &quot;$varname should exist&quot;, &quot;$varname exists&quot;], function(name, done) {
        var value = vars.find(this, name);

        assert(value, &quot;Variable &quot;+name+&quot; does not exist&quot;);
        assert(value!=undefined, &quot;Variable &quot;+name+&quot; does not exist&quot;);
        done &amp;&amp; done();
    });

    /**
     * Assert some variable should match an exact value
     *
     *
     *      variable $varname should be $value
     *      $varname should be $value
     *      $varname equals $value
     *      $varname is $value
     *      $varname = $value
     *
     * @example
     *
     *      GIVEN I set variable hello to world
     *      THEN variable hello should exist
     *
     * @method Assert variable matches a value exactly
     * @param {String} varname - scoped variable
     * @param {String} value - expected value
     */

    learn.then([&quot;variable $varname should be $value&quot;, &quot;$varname should be $value&quot;, &quot;$varname equals $value&quot;, &quot;$varname must equal $value&quot;, &quot;$varname = $value&quot; ], function(name, value, done) {

        if (value==&quot;true&quot;) value = true;
        else if (value==&quot;false&quot;) value = false;
        var v = vars.findNamed(this, name);
        assert(v != undefined, &quot;Variable [&quot;+name+&quot;] does not exist -&gt; &quot;+this.vars[name]);
        assert(v==value, &quot;Variable &quot;+name+&quot; does not equal &quot;+value);
        done &amp;&amp; done();
    });

    /**
     * Assert some variable should contain a value
     *
     *
     *      variable $varname should contain $value
     *
     * @example
     *
     *      GIVEN I set variable hello to world
     *      THEN variable hello should contain orl
     *
     * @method Assert variable value contains some string
     * @param {String} varname - scoped variable
     * @param {String} value - expected value
     */

    learn.then(&quot;variable $varname should contain $value&quot;, function(name, value, done) {
        var v = vars.get(this.vars,name);
        assert(v, &quot;Variable &quot;+name+&quot; does not exist&quot;);
        assert(v.indexOf(value)&gt;0, &quot;Variable &quot;+name+&quot; does not contain &quot;+value);
        done &amp;&amp; done();
    });

    /**
     * Assert some variable should match a regular expression (RegExp)
     *
     *
     *      variable $varname should match $regex
     *
     * @example
     *
     *      GIVEN I set variable hello to world
     *      THEN variable hello should match a-z
     *
     * @method Assert variable matches RegExp
     * @param {String} varname - scoped variable
     * @param {String} regex - regular expression
     */

    learn.then([&quot;variable $varname should match $regex&quot;, &quot;variable $varname must match $regex&quot;], function(name, regex, done) {
        var v = vars.findNamed(this,name);
        assert(v, &quot;Variable &quot;+name+&quot; does not exist&quot;);
        var re = new RegExp(regex);
        assert(re.test(v), &quot;Variable &quot;+name+&quot; does not match &quot;+regex);
        done &amp;&amp; done();
    });

    /**
     * Assert some JSON path should match a regular expression (RegExp)
     *
     *
     *      variable $varname should match $regex
     *
     * @example
     *
     *      GIVEN I set variable hello to world
     *      THEN variable hello should match a-z
     *
     * @method Assert variable matches RegExp
     * @param {String} varname - scoped variable
     * @param {String} regex - regular expression
     */

    learn.then([&quot;$path should match $regex&quot;, &quot;$path matches $regex&quot;, &quot;$path must match $regex&quot;], function(name, regex, done) {
        var v = vars.findNamed(this,name);
        assert(v, &quot;Variable &quot;+name+&quot; does not exist&quot;);
        var re = new RegExp(regex);
        assert(re.test(v), &quot;Variable &quot;+name+&quot; does not match &quot;+regex);
        done &amp;&amp; done();
    });


    /**
     * Assert some JSON path within a complex variable should match a regular expression (RegExp)
     *
     *
     *      $.hello in $varname should match $regex
     *
     * @example
     *
     *      GIVEN I set variable my.hello to world
     *      THEN $.hello in my should match a-z
     *
     * @method Assert JSON path matches RegExp
     * @param {String} path- JSON path
     * @param {String} varname - scoped variable
     * @param {String} regex - regular expression
     */

    learn.then([&quot;$path in $varname should match $regex&quot;, &quot;$path in $varname must match $regex&quot;, &quot;$path in $varname matches $regex&quot;], function(path, name, regex, done) {
        var value = vars.findNamed(this, name);
//        debug(&quot;VALUE: %j in %s -&gt; %j&quot;, value, name, this);
        assert(value, &quot;Variable &quot;+name+&quot; does not exist&quot;);
//        debug(&quot;found: %s -&gt; %j&quot;, name, value);
        var found = vars.findInPath(value, path);
debug(&quot;found: %s in %s -&gt; %j&quot;, path, name, found);
        assert(found, &quot;Path &quot;+path+&quot; not found in &quot;+name);
        var re = new RegExp(regex);
        assert(re.test(found), &quot;No path &quot;+path+&quot; in &quot;+name+&quot; matches &quot;+regex);
        done &amp;&amp; done();
    });

    /**
     * Assert that any array element in JSON path within a variable should match a regular expression (RegExp)
     *
     *
     *      $.hello in $varname should match $regex
     *
     * @example
     *
     *      GIVEN I set variable my.hello to world
     *      THEN any $.hello in my should match a-z
     *
     * @method Assert JSON path matches RegExp
     * @param {String} path - a valid JSON path
     * @param {String} varname - scoped variable
     * @param {String} regex - regular expression
     */

    learn.then([&quot;any $path in $varname should match $regex&quot;, &quot;any $path in $varname must match $regex&quot;, &quot;any $path in $varname matches $regex&quot;], function(path, name, regex, done) {
        var value = vars.findNamed(this, name);
//        debug(&quot;VALUE: %j in %s -&gt; %j&quot;, value, name, this);
        assert(value, &quot;Variable &quot;+name+&quot; does not exist&quot;);
//        debug(&quot;found: %s -&gt; %j&quot;, name, value);
        var found = vars.findAllInPath(value, path);
        assert(found, &quot;Path &quot;+path+&quot; not found in &quot;+name);

        if (!_.isArray(found)) found = [found];
        debug(&quot;found all: %s in %s -&gt; %j&quot;, path, name, found);

        var re = new RegExp(regex);
        var passed = false;
        _.each(found, function(value) {
            passed = passed?passed:re.test(value);
        })
        assert(passed, &quot;No path &quot;+path+&quot; in &quot;+name+&quot; matches &quot;+regex);
        done &amp;&amp; done();
    });

    // **********************************************************************
    // * Dialect Controller
    // **********************************************************************

    self.feature = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);

    };

    self.scenario = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);

    };
    self.annotations = function(dialect, annotations, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(annotations, &quot;missing annotations&quot;);
        assert(scope, &quot;missing scope&quot;);
    }

    debug(&quot;understands variables&quot;);
    return self;
}



    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
