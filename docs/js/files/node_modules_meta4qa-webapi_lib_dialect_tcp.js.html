<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules/meta4qa-webapi/lib/dialect/tcp.js - meta4qa</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/img/logo.png" title="meta4qa" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>Dialect Definitions for: 1.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Phrases</a></li>
                            <li><a href="#api-modules">Dialects</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Builder.html">Builder</a></li>
                                <li><a href="../classes/Common.html">Common</a></li>
                                <li><a href="../classes/Events.html">Events</a></li>
                                <li><a href="../classes/File System.html">File System</a></li>
                                <li><a href="../classes/TCP Toolkit.html">TCP Toolkit</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Variables.html">Variables</a></li>
                                <li><a href="../classes/Web API.html">Web API</a></li>
                                <li><a href="../classes/X.509 Server Certificates.html">X.509 Server Certificates</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Default Dialect.html">Default Dialect</a></li>
                                <li><a href="../modules/Web API Dialect.html">Web API Dialect</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: node_modules/meta4qa-webapi/lib/dialect/tcp.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var assert = require(&#x27;assert&#x27;);
var _ = require(&#x27;lodash&#x27;);
var async = require(&#x27;async&#x27;);
var meta4qa = require(&#x27;meta4qa&#x27;), helps = meta4qa.helpers, http=helps.http;
var debug = require(&quot;debug&quot;)(&quot;meta4qa:dialect-tcp&quot;);
var dns = require(&#x27;dns&#x27;);
var tcp = helps.tcp = require(&#x27;../helpers/tcp&#x27;);
// var ping = require (&quot;net-ping&quot;);

/**
 * TCP Network Toolkit
 * Configures the Yadda parser with phrases that support operations on HTTP APIs
 *
 * @module Web API Dialect
 * @class TCP Toolkit
 *
 */

const DNS_TYPES = [&#x27;A&#x27;, &#x27;AAAA&#x27;, &#x27;MX&#x27;, &#x27;TXT&#x27;, &#x27;SRV&#x27;, &#x27;PTR&#x27;, &#x27;NS&#x27;, &#x27;CNAME&#x27;, &#x27;SOA&#x27;];

var self = module.exports = function(learn, config) {

    // ***** WHEN *****

    learn.when([&quot;port $port at $target is open&quot;, &quot;I open port $port at $target&quot;], function(port, address, done) {
        assert(this.targets, &quot;Missing target&quot;);
        assert(port, &quot;Missing target port: &quot;+address);

        var target = this.targets[address] || { hostname: address};

        assert(target, &quot;Missing target: &quot;+address);
        assert(target.hostname, &quot;Missing target hostname: &quot;+address);

        tcp.isOpen(target.hostname, port, done);

    });

    learn.when([&quot;port $port is open&quot;, &quot;I open port $port&quot;], function(port, done) {
        assert(port, &quot;Missing target port&quot;);
        assert(this.target, &quot;Missing target&quot;);
        assert(this.target.hostname, &quot;Missing target hostname&quot;);

        var hostname = this.target.hostname;
        tcp.isOpen(hostname, port, done);

    });

    learn.when([&quot;port $port at $address is closed&quot;], function(port, address, done) {
        assert(port, &quot;Missing target port&quot;);

        assert(this.targets, &quot;Missing target&quot;);
        var target = this.targets[address] || { hostname: address};
        assert(target, &quot;Missing target: &quot;+address);
        assert(target.hostname, &quot;Missing target hostname: &quot;+address);
        assert(port, &quot;Missing target port: &quot;+address);

        tcp.isClosed(target.hostname, port, done);
    });

    learn.when([&quot;port $port is closed&quot;], function(port, done) {
        assert(port, &quot;Missing target port&quot;);
        assert(this.target, &quot;Missing target&quot;);
        assert(this.target.hostname, &quot;Missing target hostname&quot;);
        var hostname = this.target.hostname;

        tcp.isClosed(hostname, port, done);

    });


    // learn.when([&quot;I ping&quot;], function(done) {
    //     var hostname = this.target.hostname;
    //     assert(hostname, &quot;Missing target hostname: &quot;+$target);
    //
    //     session.pingHost (hostname, function (error, target) {
    //         assert(!error, &quot;Ping failed: &quot;+hostname);
    //         done &amp;&amp; done();
    //     });
    //
    // });
    //
    // learn.when([&quot;I ping $target&quot;], function($target, done) {
    //     assert($target, &quot;Missing target&quot;);
    //     var session = ping.createSession ();
    //     var target = this.targets[$target];
    //     assert($target, &quot;Unknown target: &quot;+$target);
    //     var hostname = target.hostname;
    //     assert(hostname, &quot;Missing target hostname: &quot;+$target);
    //
    //     session.pingHost (hostname, function (error, target) {
    //         assert(!error, &quot;Ping failed: &quot;+hostname);
    //         done &amp;&amp; done();
    //     });
    // });
    //

    learn.when([&quot;I lookup DNS&quot;], function(done) {
        assert(this.target, &quot;Missing an HTTP target&quot;);
        var hostname = this.target.hostname;
        assert(hostname, &quot;Missing an target hostname&quot;);
        assert(this.dns, &quot;Missing DNS&quot;)
        var self = this;

        dns.lookup(hostname, { all: true }, function(err, addresses) {
            assert(!err, &quot;Lookup failed: &quot;+hostname);
            self.dns.addresses = addresses;
            debug(&quot;DNS Lookup: %s -&gt; %j&quot;, hostname, self.dns);
            done &amp;&amp; done();
        });

    });

    learn.when([&quot;I lookup DNS $address&quot;, &quot;I lookup DNS for $address&quot;, &quot;I lookup $address&quot;], function(hostname, done) {
        assert(hostname, &quot;Missing an target hostname&quot;);
        assert(this.dns, &quot;Missing DNS&quot;)

        var self = this;

        dns.lookup(hostname, { all: true }, function(err, addresses) {
            assert(!err, &quot;Lookup failed: &quot;+hostname);
            self.dns.addresses = addresses;
            debug(&quot;DNS Lookup: %s -&gt; %j&quot;, hostname, self.dns);
            done &amp;&amp; done();
        });

    });

    learn.when([&quot;I resolve DNS $type for $address&quot;, &quot;I resolve DNS $type record for $address&quot;, &quot;I resolve $type for $address&quot;], function(type, hostname, done) {
        assert(type, &quot;Missing an DNS record type&quot;);
        assert(hostname, &quot;Missing an target hostname&quot;);
        assert(this.dns, &quot;Missing DNS&quot;)

        var self = this;
        self.dns = {};
        type = type.toUpperCase();

        dns.resolve(hostname, type, function(err, addresses) {
            assert(!err, &quot;Resolve failed (&quot;+err+&quot;): &quot;+hostname);
            self.dns.addresses = addresses;
            debug(&quot;DNS Resolved: %j&quot;, self.dns);
            done &amp;&amp; done();
        });

    });

    learn.when([&quot;I resolve DNS for $address&quot;, &quot;I resolve for $address&quot;], function(hostname, done) {
        assert(hostname, &quot;Missing an target hostname&quot;);
        assert(this.dns, &quot;Missing DNS&quot;)

        var self = this;

        async.eachSeries(DNS_TYPES, function(type, callback) {
            self.dns[type] = self.dns[type] || {};
            try {
                dns.resolve(hostname, type, function(err, addresses) {
                    if (err) callback(err);
                    else {
                        self.dns[type].addresses = addresses;
                        debug(&quot;DNS %s Resolved: %j&quot;, type, self.dns);
                        callback();
                    }
                });
            } catch (err) {
                self.dns[type].error = err;
            }
        }, function(err) {
            done &amp;&amp; done();
        });

    });

    // ***** THEN *****


    // **********************************************************************
    // * Dialect Controller
    // **********************************************************************

    self.feature = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);
    };

    self.scenario = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);

        _.defaults(scope, {peer: { authorized: false} });
    };

    self.annotations = function(dialect, annotations, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(annotations, &quot;missing annotations&quot;);
        assert(scope, &quot;missing scope&quot;);
    }

    debug(&quot;understands TCP/TLS&quot;);

    return self;
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
