<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules/meta4qa-common/lib/dialect/filesystem.js - meta4qa</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/img/logo.png" title="meta4qa" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>Dialect Definitions for: 1.2.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Phrases</a></li>
                            <li><a href="#api-modules">Dialects</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Builder.html">Builder</a></li>
                                <li><a href="../classes/Common.html">Common</a></li>
                                <li><a href="../classes/Events.html">Events</a></li>
                                <li><a href="../classes/File System.html">File System</a></li>
                                <li><a href="../classes/TCP Toolkit.html">TCP Toolkit</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Variables.html">Variables</a></li>
                                <li><a href="../classes/Web API.html">Web API</a></li>
                                <li><a href="../classes/X.509 Server Certificates.html">X.509 Server Certificates</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Default Dialect.html">Default Dialect</a></li>
                                <li><a href="../modules/Web API Dialect.html">Web API Dialect</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: node_modules/meta4qa-common/lib/dialect/filesystem.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var assert = require(&#x27;assert&#x27;);
var _ = require(&#x27;underscore&#x27;);
var fs = require(&#x27;fs&#x27;);
var path = require(&#x27;path&#x27;);
var mkdirp = require(&#x27;mkdirp&#x27;);
var debug = require(&#x27;debug&#x27;)(&#x27;meta4qa:dialect:files&#x27;);

var meta4qa = require(&#x27;meta4qa&#x27;),
    helps = meta4qa.helpers,
    files = helps.files,
    converts = meta4qa.converts,
    http = helps.http;

/**
 * File System
 * Configures the Gherkin parser with phrases that support operations on File System
 *
 * @module Default Dialect
 * @class File System
 *
 */


var self = module.exports = function(learn, config, dialect) {
    assert(learn, &quot;missing learn&quot;);
    assert(config, &quot;missing config&quot;);
    assert(dialect, &quot;missing dialect&quot;);
    assert(helps, &quot;missing helpers&quot;);
    assert(converts, &quot;missing converters&quot;);

    assert(config.paths, &quot;missing file paths&quot;);
    assert(config.paths.files, &quot;missing default file path&quot;);

    var FILE_ENCODING = &quot;UTF-8&quot;;

    learn.given([&quot;I load $varname as $format from $file&quot;, &quot;I read $varname as $format from $file&quot;], function(name, format, filename, done) {
        var file = helps.files.root(this, filename);
        assert( helps.files.exists(file), format+&quot; file not found: &quot;+file);

        format = format.toLowerCase();
        var converter = converts[format];
        assert(converter, format+&quot; files are not supported: &quot;+file);
        var raw = helps.files.load(file);
        assert( raw, format+&quot; file is empty: &quot;+file);
        var self = this;
        converter(raw, function(err, json) {
            assert(!err, format+&quot; not valid: &quot;+file);
            helps.vars.set(self.vars,name,json);
            debug(&quot;%s loaded: %j&quot;, format, file);
        })

        done &amp;&amp; done();
    });

    learn.given([&quot;I load $varname as $format from $folder $file&quot;, &quot;I read $varname as $format from $folder $file&quot;], function(name, format, folder, filename, done) {
        var file = helps.files.root(this, folder, filename);
        assert( helps.files.exists(file), format+&quot; file not found: &quot;+file);

        format = format.toLowerCase();
        var converter = converts[format];
        assert(converter, format+&quot; files are not supported: &quot;+file);
        var raw = helps.files.load(file);
        assert( raw, format+&quot; file is empty: &quot;+file);
        var self = this;
        converter(raw, function(err, json) {
            assert(!err, format+&quot; not valid: &quot;+file);
            helps.vars.set(self.vars,name,json);
            debug(&quot;%s loaded: %j&quot;, format, file);
        })

        done &amp;&amp; done();
    });

    learn.given([&quot;I load $varname from $file&quot;, &quot;I read $varname from $file&quot;], function(name, filename, done) {
        var file = helps.files.root(this, filename);
        var format = path.extname(file);
        assert(format, &quot;missing file extension: &quot;+file);
        assert( helps.files.exists(file), format+&quot; file not found: &quot;+file);

        format = format.substring(1).toLowerCase();
        var converter = converts[format];
        assert(converter, format+&quot; files are not supported: &quot;+file);
        var raw = helps.files.load(file);
        assert( raw, format+&quot; file is empty: &quot;+file);
        var self = this;
        converter(raw, function(err, json) {
            assert(!err, format+&quot; not valid: &quot;+file);
            helps.vars.set(self.vars, name, json);
            debug(&quot;%s loaded: %s @ %s&quot;, format, name, file);
        })

        done &amp;&amp; done();
    });

    learn.given([&quot;I find $filter in folder $folder&quot;], function(filter, folder, done) {
        if (filter == &quot;files&quot;) filter = &quot;.&quot;;
        var file = helps.files.root(this, folder);
        var files = helps.files.find(file, filter);
        helps.vars.set(this.vars, &quot;files&quot;, files);
        done &amp;&amp; done();
    });

    learn.given([&quot;I find $filter in $type folder $folder&quot;], function(filter, type, folder, done) {
        if (filter == &quot;files&quot;) filter = &quot;.&quot;;
        var root = this.paths[type] || config.paths[type];
        var file = helps.files.path(root, folder);

        var files = helps.files.find(file, filter);
        helps.vars.set(this.vars, &quot;files&quot;, files);
        done &amp;&amp; done();
    });

    learn.given([&quot;I find $filter in folder $folder as $varname&quot;], function(filter, folder, varname, done) {
        if (filter == &quot;files&quot;) filter = &quot;.&quot;;
        var file = helps.files.root(this, folder);
        // console.log(&quot;FIND (%s): %s -&gt; %s&quot;, filter, folder);
        var files = helps.files.find(file, filter, function(filename, json) {
            var name = path.basename(filename,filter);
            json.name = json.name || name;
            json.id = json.id || helps.vars.uuid(filename);
            return json;
        });
        helps.vars.set(this.vars, varname, files);
        done &amp;&amp; done();
    });

    learn.given([&quot;I find $filter in $type folder $folder as $varname&quot;], function(filter, type, folder, varname, done) {
        if (filter == &quot;files&quot;) filter = &quot;.&quot;;
        var root = this.paths[type] || config.paths[type];
        var file = helps.files.path(root, folder);
        // console.log(&quot;FIND (%s): %s -&gt; %s&quot;, filter, folder);
        var files = helps.files.find(file, filter, function(filename, json) {
            var name = path.basename(filename,filter);
            json.name = json.name || name;
            json.id = json.id || helps.vars.uuid(filename);
            return json;
        });
        helps.vars.set(this.vars, varname, files);
        done &amp;&amp; done();
    });

    learn.when([&quot;I save $varname to $file&quot;, &quot;I write $varname to $file&quot;], function(name, filename, done) {
        var file = helps.files.root(this, filename);
        fs.writeFileSync(file, JSON.stringify(this.vars[name] || {}) );
        debug(&quot;file saved: &quot;+file);
        done &amp;&amp; done();
    });

    learn.when([&quot;I delete file $file&quot;, &quot;I delete folder $file&quot;], function(filename, done) {
        assert(filename, &quot;Missing filename&quot;);
        var file = helps.files.root(this, filename);
        helps.files.rmrf(file);
        done &amp;&amp; done();
    });

    learn.when([&quot;I delete $path $file_folder $file&quot;], function(path, type, filename, done) {
        assert(path, &quot;Missing path&quot;);
        assert(type, &quot;Missing type (file or folder)&quot;);
        assert(filename, &quot;Missing filename&quot;);
        var root = this.paths[path] || config.paths[path] || helps.vars.get(this.vars,path) || helps.vars.get(this,path);
        assert(root, &quot;Missing root folder: &quot;+path);
        var file = helps.files.path(root, filename);
        debug(&quot;DELETE %s -&gt; %s (%s)&quot;, type, file, filename);

        helps.files.rmrf(file);
        done &amp;&amp; done();
    });

    learn.when([&quot;I mkdir $folder&quot;], function(folder, done) {
        var path = helps.files.root(this, folder);
        mkdirp.sync(path);
        done &amp;&amp; done();
    });

    // ***** THEN *****

    learn.then([&quot;file $file exists&quot;, &quot;file $file should exist&quot;, &quot;file $file must exist&quot;], function(filename, done) {
        var file = helps.files.root(this, filename);
        assert (helps.files.exists(file), &quot;File &quot;+file+&quot; does not exist&quot;)
        debug(&quot;file exists: &quot;+file);
        done &amp;&amp; done();
    });


    learn.then([&quot;$path file $file exists&quot;, &quot;$path file $file should exist&quot;, &quot;$path file $file must exist&quot;], function(path, filename, done) {
        var root = this.paths[path] || this.paths[path] || helps.vars.get(this.vars,path) || helps.vars.get(this,path);
        assert(root, &quot;Missing root folder: &quot;+path);
        var file = helps.files.path(root, filename);
        assert (helps.files.exists(file), path+&quot; file does not exist: &quot;+file);
        assert(!helps.files.isDirectory(file), path+&quot; filename is a folder: &quot;+file);

        done &amp;&amp; done();
    });


    learn.then([&quot;file $file doesn&#x27;t exist&quot;,&quot;file $file does not exist&quot;,
        &quot;folder $file doesn&#x27;t exist&quot;,&quot;folder $file does not exist&quot;], function(filename, done) {

        var file = helps.files.root(this, filename);
        try {
            var stat = fs.statSync(file);
            assert (!stat, &quot;File &quot;+file+&quot; exist&quot;)
        } catch(e) {
            debug(&quot;file not found: &quot;+file);
            done &amp;&amp; done();
        }
    });

    learn.then([&quot;folder $file exists&quot;, &quot;folder $file should exist&quot;], function(filename, done) {
        var file = helps.files.root(this, filename);

        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);
        assert(helps.files.isDirectory(file), &quot;File is not folder: &quot;+file);
        debug(&quot;Folder exists: &quot;+file);
        done &amp;&amp; done();
    });


    learn.then([&quot;folder $file should not exist&quot;, &quot;$file folder should not exist&quot;], function(filename, done) {
        var file = helps.files.root(this, filename);

        assert (!helps.files.exists(file), &quot;Folder exists: &quot;+file);
        debug(&quot;Folder does not exist: &quot;+file);
        done &amp;&amp; done();
    });

    learn.then([&quot;$name $type $file exists&quot;, &quot;$name $type $file should exist&quot;], function(name, type, filename, done) {
        var root = this.paths[name] || config.paths[name] || helps.vars.get(this.vars,name) || helps.vars.get(this,name);
        assert(root, &quot;Missing root folder: &quot;+name);
        var file = helps.files.path(root, filename);

        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);
        if (type == &quot;folder&quot;) {
            assert(helps.files.isDirectory(file), &quot;File is not folder: &quot;+file);
            debug(&quot;Folder &#x27;%s&#x27; exists: %s&quot;, name, file);
        }
        done &amp;&amp; done();
    });

    learn.then([&quot;file $file is not empty&quot;], function(filename, done) {
        var file = helps.files.root(this, filename);
        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);
        assert (helps.files.size(file)&gt;0, &quot;File is empty: &quot;+file);
        done &amp;&amp; done();
    });


    learn.then(&quot;file $file should contain $expression&quot;, function(filename, expression, done) {
        var file = helps.files.root(this, filename);
        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);

        var data = helps.files.load(file);
        var found = new RegExp(expression).test(data);
        assert(found, &quot;File &quot;+file+&quot; does not contain /&quot;+expression+&quot;/&quot;);
        done &amp;&amp; done();
    });

    learn.then(&quot;$name $type $file should contain $expression&quot;, function(name, type, filename, expression, done) {
        var root = this.paths[name] || config.paths[name] || helps.vars.get(this.vars,name) || helps.vars.get(this,name);
        assert(root, &quot;Missing root folder: &quot;+name);
        var file = helps.files.path(root, filename);

        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);

        var data = helps.files.load(file);
        var found = new RegExp(expression).test(data);
        assert(found, &quot;File &quot;+file+&quot; does not contain /&quot;+expression+&quot;/&quot;);
        done &amp;&amp; done();
    });


    learn.then(&quot;file $file should not contain $expression&quot;, function(filename, expression, done) {
        var file = helps.files.root(this, filename);
        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);

        var data = helps.files.load(file);
        var found = new RegExp(expression).test(data);
        assert(!found, &quot;File contains /&quot;+expression+&quot;/&quot;);
        done &amp;&amp; done();
    });

    learn.then(&quot;$name $type $file should not contain $expression&quot;, function(name, type, filename, expression, done) {
        var root = this.paths[name] || config.paths[name] || helps.vars.get(this.vars,name) || helps.vars.get(this,name);
        assert(root, &quot;Missing root folder: &quot;+name);
        var file = helps.files.path(root, filename);
        assert (helps.files.exists(file), &quot;File does not exist: &quot;+file);

        var data = helps.files.load(file);
        var found = new RegExp(expression).test(data);
        assert(!found, &quot;File contains /&quot;+expression+&quot;/&quot;);
        done &amp;&amp; done();
    });

    // **********************************************************************
    // * Dialect Controller
    // **********************************************************************

    self.feature = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);

    };

    self.scenario = function(dialect, scope) {
        assert(dialect, &quot;missing dialect&quot;);
        assert(scope, &quot;missing scope&quot;);

    };

    self.annotations = function(dialect, annotations, scope) {
    }

    debug(&quot;understands files &amp; folders&quot;);
    return self;
}



    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
